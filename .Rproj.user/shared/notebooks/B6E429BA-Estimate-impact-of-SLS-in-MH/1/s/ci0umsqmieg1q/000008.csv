"0","# temp: Change 2016 to 2015 to see if it fixes the balanced panel error"
"0","aser$year[aser$year ==2016] <- 2015"
"0",""
"0","# list the states with any NAs for std3_read or std5_read"
"0","states_w_na <- unique(aser$state_abbr[is.na(aser$std3_read) | is.na(aser$std5_read)])"
"0",""
"0","# drop these states from the dataset (they are all small and unlikely to be good matches anyway). I also drop 2006 data because for some reason that is giving me the unbalanced error"
"0","aser <- aser %>% filter(!(state_abbr %in% states_w_na)) %>% "
"0","  filter(year != 2006) "
"0",""
"0","# Create index for state "
"0","aser <- aser %>% group_by(state_abbr) %>% mutate(id = group_indices())"
"0","  "
"0",""
"0","dataprep.out <- dataprep(foo = as.data.frame(aser),"
"0","         predictors = c(""std3_read"", ""std5_read""),"
"0","         predictors.op = ""mean"","
"0","         time.predictors.prior = 2007:2014,"
"0","         special.predictors = list("
"0","           list(""nsdp_2014"", 2014, ""mean""),"
"0","           list(""std3_read"", 2014, ""mean""),"
"0","           list(""std5_math"", 2015, ""mean"")"
"0","         ),"
"0","         dependent = ""std5_read"","
"0","         unit.variable = ""id"","
"0","         unit.names.variable = ""state_abbr"","
"0","         time.variable = ""year"","
"0","         treatment.identifier = 13,"
"0","         controls.identifier = seq(1,max(aser$id),1)[-13],"
"0","         time.optimize.ssr = 2007:2014,"
"0","         time.plot = 2007:2015)"
"2","Error in `[.data.frame`(foo, , sp.name) : undefined columns selected
"
